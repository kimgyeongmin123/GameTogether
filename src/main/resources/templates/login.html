<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>

    <!--    Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>
<body>
<header>
    <h1>Mango (✌’ω’)✌</h1>
    <h5>망고의 게시판에 오신 것을 환영합니다.</h5>
</header>
    <h2>LOGIN</h2>
    <p>서비스를 사용하려면 로그인을 해주세요!</p>

    <div class = "mb-2">
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="floatingInput" name="username">
                <label for="floatingInput">Email address</label>
            </div>
            <div class="form-floating">
                <input type="password" class="form-control" id="floatingPassword" name="password">
                <label for="floatingPassword">Password</label>
            </div>
            <button type="submit" class="btn btn-primary" id="login-btn">로그인</button>

        <a href="/oauth2/authorization/google"><img src="/img/google.png"></a>

        <button type="button" class="btn btn-secondary mt-3" onclick="location.href='/signup'">회원가입</button>
    </div>

<script>
    const loginButton = document.getElementById("login-btn");

if(loginButton){
    loginButton.addEventListener("click", (event) => {
        fetch("/login", {
            method : "POST",
            headers : {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                email:document.getElementById("floatingInput").value,
                password:document.getElementById("floatingPassword").value,
            }),
        }).then(response => {
            if(!response.ok){
                throw new Error("로그인 실패");
            }
            return response.text();
        })
        .then(token => {
            localStorage.setItem("access_token", token);
            window.location.href = "/articles";
        })
        .catch(error => {
            console.error("로그인 에러 : ", error);
            alert("아이디와 비밀번호를 확인해주세요.");
        });
    });
}
</script>

</body>
</html>